# original
https://github.com/leoChaoGlut/ambari-azkaban-service 
Thanks to [leo]https://github.com/leoChaoGlut/
# Author: [jzyhappy]https://github.com/jzyhappy/

# Building from Source
Azkaban builds use Gradle (downloads automatically when run using gradlew which is the Gradle wrapper) and requires Java 8 or higher.

The following commands run on *nix platforms like Linux, OS X.
```shell
# Build Azkaban
./gradlew build

# Clean the build
./gradlew clean

# Build and install distributions
./gradlew installDist

# Run tests
./gradlew test

# Build without running tests
./gradlew build -x test
```
These are all standard Gradle commands. Please look at Gradle documentation for more info.

Gradle creates .tar.gz files inside project directories. eg. ./azkaban-solo-server/build/distributions/azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz. Untar using tar -xvzf path/to/azkaban-*.tar.gz.
https://azkaban.github.io/azkaban/docs/latest/

# setup
## Database setup
We suggest users to opt for Mysql as Azkaban database, because we build up a few Mysql connection enhancements to facilitate AZ set up, and strengthen service reliability:

### Install Mysql

Installation of MySQL DB won’t be covered by these instructions, but you can access the instructions on MySQL Documentation Site.

### Set up Mysql

a. create database for Azkaban.:
```
# Example database creation command, although the db name doesn't need to be 'azkaban'
mysql> CREATE DATABASE azkaban;
```
b. create a mysql user for Azkaban. For example,:
```
# Example database creation command. The user name doesn't need to be 'azkaban'
mysql> CREATE USER 'username'@'%' IDENTIFIED BY 'password';
# give the user INSERT, SELECT, UPDATE, DELETE permission on all tables in the Azkaban db.
mysql> GRANT SELECT,INSERT,UPDATE,DELETE ON azkaban.* to '<username>'@'%' WITH GRANT OPTION;
```
c. Mysql Packet Size may need to be re-configured. MySQL may have, by default, a ridiculously low allowable packet size. To increase it, you’ll need to have the property max_allowed_packet set to a higher number, say 1024M. To configure this in linux, open /etc/my.cnf. Somewhere after mysqld, add the following:
```
[mysqld]
...
max_allowed_packet=1024M
```
d. To restart MySQL, you can run:
```
$ sudo /sbin/service mysqld restart
```
###Create the Azkaban Tables

Run individual table creation scripts from latest table statements on the MySQL instance to create your tables.

Alternatively, run create-all-sql-<version>.sql generated by build process. The location is the file is at /Users/latang/LNKDRepos/azkaban/azkaban-db/build/distributions/azkaban-db-<version>, after you build azkaban-db module by
```
cd azkaban-db; ../gradlew build installDist
```
  
## To download the Azkaban service folder, run below
```shell
VERSION=`hdp-select status hadoop-client | sed 's/hadoop-client - \([0-9]\.[0-9]\).*/\1/'`
sudo git clone https://github.com/jzyhappy/ambari-azkaban-service.git /var/lib/ambari-server/resources/stacks/HDP/$VERSION/services/AZKABAN
```

## restart ambari
```
ambari-server restart
```

## set configuration
The location is the file is at ./configuration

`azkaban-db.xml`
```yaml
<property>
    <name>mysql.host</name>
    <value><your mysql server></value>
</property>
```

`azkaban-executor.properties.xml`
```yaml
...
<property>
    <name>azkaban.webserver.url</name>
    <value>http://<your webserver>:10200</value>
</property>
...
<property>
    <name>mysql.host</name>
    <value><your mysql server></value>
</property>
...
```

`azkaban-web.properties.xmll`
```yaml
<property>
    <name>mysql.host</name>
    <value><your mysql server></value>
</property>
```
## set`/package/scripts/download.ini`
```
azkaban_web_url = <your repo>/azkaban-web-server-0.1.0-SNAPSHOT.tar.gz
azkaban_executor_url = <your repo>/azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz
azkaban_db_url = <you repo>/create-all-sql-0.1.0-SNAPSHOT.sql

```
# Intro
Ambari 集成 Azkaban

# Major Project Structure
- configuration : azkaban 配置文件
- package : 
  - scripts :  ambari 管理逻辑脚本
    - azkaban_executor.py  
    - azkaban_web.py
    - common.py
    - download.ini
    - params.py
# Usage
https://cwiki.apache.org/confluence/display/AMBARI/Overview
